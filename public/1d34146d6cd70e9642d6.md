---
title: CDKã‚³ãƒ³ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ åˆå¿ƒè€…å‘ã‘TIPS
tags:
  - CDK
private: false
updated_at: '2025-05-01T06:05:58+09:00'
id: 1d34146d6cd70e9642d6
organization_url_name: null
slide: false
ignorePublish: false
---
# ã¯ã˜ã‚ã«
æœ€è¿‘ã€[aws-cdk](https://github.com/aws/aws-cdk)ãƒªãƒã‚¸ãƒˆãƒªã¸ã®OSSã‚³ãƒ³ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å§‹ã‚ã¾ã—ãŸã€‚ãã®éš›ã«çŸ¥ã£ã¦ãŠãã¨ä¾¿åˆ©ãªTIPSã‚’ã„ãã¤ã‹ç´¹ä»‹ã—ã¾ã™ã€‚

# å–ã‚Šçµ„ã‚€Issueã®æ¢ã—æ–¹
OSSã‚³ãƒ³ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ã‚„ã‚‹ã«ã‚ãŸã£ã¦è‡ªåˆ†ã¯ã“ã“ãŒä¸€ç•ªé¬¼é–€ã§ã—ãŸã€‚aws-cdkãƒªãƒã‚¸ãƒˆãƒªã«ã¯å¤§é‡ã®IssueãŒå­˜åœ¨ã™ã‚‹ãŸã‚ã€ä¸Šã‹ã‚‰é †ã«ãƒã‚§ãƒƒã‚¯ã—ã¦ã„ãã®ã¯éç¾å®Ÿçš„ã§ã™ã€‚æ¢ã—æ–¹ã®ãƒã‚¤ãƒ³ãƒˆãŒã„ãã¤ã‹ã‚ã‚Šã¾ã™ã€‚
### ãƒ©ãƒ™ãƒ«ã§ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
ã¾ãšã¯ãƒ©ãƒ™ãƒ«ã§çµã‚Šè¾¼ã‚“ã§æ¢ã™ã¨ã‚ˆã„ã§ã—ã‚‡ã†ã€‚
- good first issue
    - åå‰ã®é€šã‚Šåˆå¿ƒè€…å‘ã‘ã®Issue
- effort/small
    - å¯¾å¿œé‡ãŒå°‘ãªã‚ã¨è¦‹ç©ã‚‚ã‚‰ã‚Œã¦ã„ã‚‹Issue
- p2, p3
    - å„ªå…ˆåº¦ãŒé«˜ããªã„Issue
    - effort/smallã¨ä¸€ç·’ã«ä»˜ã‘ã‚‰ã‚Œã¦ã„ã‚‹ã“ã¨ãŒå¤šã„ã‹ã‚‚

### VPC Interface Endpointã®å®šæ•°è¿½åŠ 
aws-cdkã§ã¯[vpc-endpoint.ts](https://github.com/tttol/aws-cdk/blob/main/packages/aws-cdk-lib/aws-ec2/lib/vpc-endpoint.ts)ã¨ã„ã†ãƒ•ã‚¡ã‚¤ãƒ«ã§VPC Interface Endpointã‚’å®šç¾©ã—ã¦ã„ã¾ã™ã€‚ä¸­èº«ã¯å®šæ•°ã®ç¾…åˆ—ã«ãªã£ã¦ãŠã‚Šã€å„ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã«å¯¾ã—ã¦1å¯¾1ã§å®šæ•°ãŒå®šç¾©ã•ã‚Œã¦ã„ã¾ã™ã€‚

```typescript:ä¾‹ï¼šAmazon Athenaã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã«å¯¾ã™ã‚‹å®šæ•°å®šç¾©
  public static readonly ATHENA = new InterfaceVpcEndpointAwsService('athena');
```

AWSã®ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã§æ–°ã‚µãƒ¼ãƒ“ã‚¹ãŒç™ºè¡¨ã•ã‚Œã‚‹ã¨ã€å¯¾å¿œã™ã‚‹å®šæ•°ã‚’è¿½åŠ ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ä¾‹ãˆã°2024å¹´12æœˆã«ç™ºè¡¨ã•ã‚ŒãŸAmazon Bedrock Data Automationï¼ˆãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç‰ˆï¼‰ã«å¯¾ã—ã¦ã€ä»¥ä¸‹ã®ã‚ˆã†ã«å®šæ•°ã‚’è¿½åŠ ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
https://aws.amazon.com/about-aws/whats-new/2024/12/amazon-bedrock-data-automation-available-preview/

```diff
  public static readonly BEDROCK_AGENT = new InterfaceVpcEndpointAwsService('bedrock-agent');
  public static readonly BEDROCK_AGENT_RUNTIME = new InterfaceVpcEndpointAwsService('bedrock-agent-runtime');
  public static readonly BEDROCK_RUNTIME = new InterfaceVpcEndpointAwsService('bedrock-runtime');
+  public static readonly BEDROCK_DATA_AUTOMATION = new InterfaceVpcEndpointAwsService('bedrock-data-automation');
+  public static readonly BEDROCK_DATA_AUTOMATION_FIPS = new InterfaceVpcEndpointAwsService('bedrock-data-automation-fips');
+  public static readonly BEDROCK_DATA_AUTOMATION_RUNTIME = new InterfaceVpcEndpointAwsService('bedrock-data-automation-runtime');
+  public static readonly BEDROCK_DATA_AUTOMATION_RUNTIME_FIPS = new InterfaceVpcEndpointAwsService('bedrock-data-automation-runtime-fips');
  public static readonly BILLING = new InterfaceVpcEndpointAwsService('billing');
```

ã“ã®4è¡Œã‚’è¿½åŠ ã™ã‚‹ã ã‘ã§PRã‚’ä½œæˆã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚
å‚è€ƒPRï¼šhttps://github.com/aws/aws-cdk/pull/33674

æœªå¯¾å¿œã®VPC Interface Endpointã®ä¸€è¦§ã‚’è‡ªå‹•é›†è¨ˆã™ã‚‹ãƒ„ãƒ¼ãƒ«ã‚’ @badmintoncryer ã•ã‚“ãŒä½œæˆã—ã¦ãã ã•ã£ã¦ã„ã‚‹ãŸã‚ã€ã“ã“ã‹ã‚‰æœªå¯¾å¿œã®ã‚‚ã®ã‚’ç¢ºèªã—ã¦PRä½œæˆã™ã‚‹ã ã‘ã§ç°¡å˜ã«ã‚³ãƒ³ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ï¼

https://github.com/badmintoncryer/cdk-missing-interface-endpoint

å‚è€ƒãƒã‚¹ãƒˆï¼šhttps://x.com/nixieminton/status/1896404099148726340

### `Error`ã‚’ã‚¹ãƒ­ãƒ¼ã—ã¦ã„ã‚‹ç®‡æ‰€ã‚’`ValidationError`/`UnscopedValidationError`ã«ç½®æ›ã™ã‚‹
aws-cdkã§ã¯`throw new Error`ã¨è¨˜è¼‰ã—ã¦ã„ã‚‹ç®‡æ‰€ã‚’`throw new ValidationError` or `thorw new UnscopedValidationError`ã«ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã™ã‚‹æ–¹é‡ãŒã‚ã‚Šã¾ã™ã€‚`ValidationError`ã¨`UnscopedValidationError`ã¯CDKãƒªãƒã‚¸ãƒˆãƒªå†…ã§å®šç¾©ã•ã‚ŒãŸã‚«ã‚¹ã‚¿ãƒ ä¾‹å¤–ã‚¯ãƒ©ã‚¹ã§ã™ã€‚

å‚è€ƒæƒ…å ±ï¼š
- https://github.com/aws/aws-cdk/issues/32569
- https://x.com/nixieminton/status/1899797538913595723


å‚è€ƒPR

https://github.com/aws/aws-cdk/pull/33885


# ãƒ“ãƒ«ãƒ‰
aws-cdkãƒªãƒã‚¸ãƒˆãƒªã®ãƒ“ãƒ«ãƒ‰ã¯ä»¥ä¸‹ã‚³ãƒãƒ³ãƒ‰ã§å®Ÿè¡Œå¯èƒ½ã§ã™ã€‚
```shell
# packages/aws-cdk-libãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç¯„å›²ã‚’çµã£ã¦å®Ÿè¡Œ
npx lerna run build --scope=aws-cdk-lib
```
aws-cdkãƒªãƒã‚¸ãƒˆãƒªã¯å·¨å¤§ãªã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹ã§ã‚ã‚‹ãŸã‚ã€ãƒªãƒã‚¸ãƒˆãƒªå…¨ä½“ã®ãƒ“ãƒ«ãƒ‰ã‚’å®Ÿæ–½ã™ã‚‹ã¨20åˆ†è¿‘ãã‹ã‹ã£ã¦ã—ã¾ã†ã‚ˆã†ã§ã™ã€‚ãã®ãŸã‚ã€`--scope=aws-cdk-lib`ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§ãƒ“ãƒ«ãƒ‰å¯¾è±¡ã‚’åŒºåˆ‡ã£ã¦å®Ÿè¡Œã™ã‚‹ã®ãŒä¸€èˆ¬çš„ã§ã™ã€‚
å®Ÿè¡Œæ™‚ã«node.jsã®ãƒ¡ãƒ¢ãƒªä¸è¶³ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹å ´åˆã€`export NODE_OPTIONS="--max-old-space-size=8192"`ã‚’å®Ÿè¡Œã—ã¦ãƒ¡ãƒ¢ãƒªé ˜åŸŸã‚’ã‚ã‚‰ã‹ã˜ã‚æ‹¡å¼µã—ã¦ãŠãã¨ã‚ˆã„ã§ã™ã€‚
â€»å‚è€ƒï¼šM2 MacBook Air ãƒ¡ãƒ¢ãƒª8Gã ã¨ä¸Šè¨˜ã‚³ãƒãƒ³ãƒ‰ãŒãªã„ã¨ãƒ¡ãƒ¢ãƒªä¸è¶³ã«ãªã‚Šã¾ã—ãŸ

ã¾ãŸã€ä¸€åº¦ãƒ“ãƒ«ãƒ‰ã—ãŸå†…å®¹ã¯ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã•ã‚Œã¾ã™ã€‚ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ç„¡è¦–ã—ã¦å®Ÿè¡Œã™ã‚‹å ´åˆã¯`--skip-nx-cache`ã‚’ä»˜ä¸ã—ã¾ã—ã‚‡ã†ã€‚
```
# ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ç„¡è¦–ã—ã¦ãƒ“ãƒ«ãƒ‰
npx lerna run build --scope=aws-cdk-lib --skip-nx-cache
```

# å·®åˆ†ãƒ“ãƒ«ãƒ‰
`yarn watch`ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ã§ã€ãƒ•ã‚¡ã‚¤ãƒ«ãŒä¿å­˜ã•ã‚Œã‚‹ãŸã³ã«å·®åˆ†ãƒ“ãƒ«ãƒ‰ã‚’å®Ÿæ–½ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
```shell
$ cd packages/aws-cdk-lib
$ yarn watch

5:52:22 PM - Starting compilation in watch mode...
```
ä¸­æ­¢ã™ã‚‹ã¨ãã¯Ctrl+Cã§æŠœã‘ã¾ã™

# ãƒ•ã‚©ãƒ¼ã‚¯å…ƒã®å·®åˆ†ã‚’è‡ªèº«ã®ãƒªãƒã‚¸ãƒˆãƒªã«é©ç”¨
ãƒ•ã‚©ãƒ¼ã‚¯ã—ãŸãƒªãƒã‚¸ãƒˆãƒªã¨æœ¬å®¶ã®ãƒªãƒã‚¸ãƒˆãƒªã«å·®åˆ†ãŒç™ºç”Ÿã—ãŸå ´åˆã€ãƒ•ã‚©ãƒ¼ã‚¯ã—ãŸãƒªãƒã‚¸ãƒˆãƒªã«å·®åˆ†ã‚’é©ç”¨ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ãƒ–ãƒ©ã‚¦ã‚¶ã®GitHubã®UIã‹ã‚‰Sync forkã‚’æ¯åº¦å®Ÿè¡Œã™ã‚‹ã®ã¯æ‰‹é–“ãªã®ã§ã€ãƒ­ãƒ¼ã‚«ãƒ«ã®CLIç’°å¢ƒã‹ã‚‰å®Ÿè¡Œã™ã‚‹ã¨ã‚ˆã„ã§ã™ã€‚
```shell
# ãƒ•ã‚©ãƒ¼ã‚¯å…ƒã®aws-cdkãƒªãƒã‚¸ãƒˆãƒªã‚’upstreamã¨ã„ã†åå‰ã§ç™»éŒ²
git remote add upstream https://github.com/aws/aws-cdk.git

# æœ¬å®¶ã®å·®åˆ†ã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã«å–ã‚Šè¾¼ã‚€
git switch main
git fetch upstream
git merge upstream/main

# æœ¬å®¶ã®å·®åˆ†ã‚’ãƒªãƒ¢ãƒ¼ãƒˆãƒªãƒã‚¸ãƒˆãƒªã®è‡ªåˆ†ã®ãƒ–ãƒ©ãƒ³ãƒã¸PUSH
git push
```

è‡ªåˆ†ã¯æ¯å›å¿˜ã‚Œã‚‹ã®ã§.shãƒ•ã‚¡ã‚¤ãƒ«ã«æ›¸ã„ã¦zshrcã«aliasã‚’ç™»éŒ²ã—ã¦ã¾ã™ã€‚

```sh:sync-fork.sh
#!/bin/zsh

set -e  # ã‚¨ãƒ©ãƒ¼ãŒå‡ºãŸã‚‰æ­¢ã‚ã‚‹

echo "ğŸ” Switching to main branch..."
cd path/to/aws-cdk
git switch main

echo "ğŸ”„ Fetching from upstream..."
git fetch upstream

echo "ğŸ”€ Merging upstream/main into local main..."
git merge upstream/main

echo "ğŸ“¤ Pushing changes to origin..."
git push

echo "âœ… Fork sync completed!"
```

```zsh:.zshrc
alias sync-fork="path/to/sync-fork.sh"
```

# Test
### Unit Test
U Testã®å®Ÿè¡Œæ–¹æ³•ã¯ä»¥ä¸‹
```shell
cd packages/aws-cdk-lib/aws-apigateway/test
yarn test restapi.test.ts
```
### Integration Test
Integration Testã®å®Ÿè¡Œæ–¹æ³•ã¯ä»¥ä¸‹
```shell
# ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã‚³ãƒ¼ãƒ‰ã®ãƒ“ãƒ«ãƒ‰ã‚’äºˆã‚å®Ÿæ–½ã—ã¦ãŠãk
# @aws-cdk-testingã‚’ãƒ“ãƒ«ãƒ‰ã™ã‚‹(at repo root)
npx lerna run build --scope=@aws-cdk-testing/framework-integ

# è‡ªèº«ãŒä½œæˆ/æ›´æ–°ã—ãŸinteg.*.tsã‚’integ.*.jsãƒ•ã‚¡ã‚¤ãƒ«ã«ãƒˆãƒ©ãƒ³ã‚¹ãƒ‘ã‚¤ãƒ«ã™ã‚‹
cd packages/@aws-cdk-testing/framework-integ/
yarn tsc

# integ test å®Ÿè¡Œï¼ˆinteg.restapi.jsã¯ä¸€ä¾‹ï¼‰
yarn integ --update-on-failed test/aws-apigateway/test/integ.restapi.js 
```

`yarn tsc`ã‚’å®Ÿè¡Œã—ãŸå¾Œã«å®Ÿéš›ã«integ.*.jsãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç¢ºèªã—ã€tsãƒ•ã‚¡ã‚¤ãƒ«ã«æ–½ã—ãŸå¤‰æ›´ãŒåæ˜ ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦ãŠãã¨è‰¯ã„ã§ã™ã€‚

integ testã§ã¯å®Ÿéš›ã®AWSã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«å¯¾ã—ã¦cdk deployãŒå®Ÿè¡Œã•ã‚Œã¾ã™ã€‚AWS Organizationsã§integ testç”¨ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’æ‰•ã„å‡ºã—ã¦ãŠãã¨ä¾¿åˆ©ã§ã™ã€‚

https://qiita.com/tttol777/items/cfd5fa540493cd6be9f9

integ testã«é–¢ã™å‚è€ƒè³‡æ–™ï¼šhttps://jaws-ug-cdk.github.io/cdk-conf-2024-contribute-workshop/4-%E6%A9%9F%E8%83%BD%E8%BF%BD%E5%8A%A0pr%E3%81%AE%E4%BD%9C%E6%88%90/display-name/#%E7%B5%B1%E5%90%88%E3%83%86%E3%82%B9%E3%83%88%E3%81%AE%E8%BF%BD%E5%8A%A0

# ã•ã„ã”ã«
ä»¥ä¸Šã§ã™ï¼ä»–ã«ã‚‚æ€ã„ã¤ã„ãŸã‚‰è¿½è¨˜ã—ã¾ã™ã€‚
