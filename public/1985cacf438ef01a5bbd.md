---
title: VM vs コンテナの整理
tags:
  - VM
  - container
private: false
updated_at: '2025-06-04T11:53:10+09:00'
id: 1985cacf438ef01a5bbd
organization_url_name: null
slide: false
ignorePublish: false
---
# VMとコンテナを図で比較
他のサイトでもよく見かけるやつですね。Guest OSと仮想マシンがコンテナにはないのがミソです。
![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/159675/af1deac5-d3bb-4360-a12d-481886eaa2fc.png)

# コンテナのメリット
### 軽量
コンテナはVMと比較するとGuest OSと仮想マシン(VM)が削減されるので、軽量になります。VMはGB単位ですが、コンテナイメージはMB単位です。

### デリバリーが容易
コンテナイメージはDocker Hubなどのイメージリポジトリで管理可能です。クライアント側でコンテナランタイム環境があれば、イメージをpullしてコンテナを起動するだけでサッと起動が可能です。
また、コンテナイメージをpushする際にタグを付与することができるためここでイメージのバージョン管理も容易に行うことができます。

一方でVMでは稼働させたいアプリケーションのモジュールをアップロードし、コマンドから起動する必要があります。

また、コンテナは起動だけでなくシャットダウンも容易です。`docker stop [container ID]`で簡単にコンテナをシャットダウンすることができます。ただしPID 1問題には注意が必要です。

:::note info
PID 1問題

コンテナ内で実行するプロセスがPID1に割り当てられることでシャットダウンに時間を要してしまう問題。

UNIXシステムにおいてPID1は特別なプロセスとして定義されており、通常はinitプロセスが割り当てられます。仮にinitプロセスがkillされるとシステム自体がダウンする恐れがあるため、PID1のプロセスはkillされなようにカーネルが保護しています。

コンテナでは特に意識せずに起動するとPID1にアプリケーションのプロセスが割り当てられてしまいます。このコンテナを終了する際にPID1のアプリケーションプロセスにSIGTERMが送られますが、PID1はカーネルに保護されているためSIGTERMを正しく受け取ることができず、結果的にコンテナ終了に時間を要してしまいます。

参考：https://speakerdeck.com/superbrothers/pid1-ha-kanerukara-te-bie-xi-isareterututeben-dang-desuka
:::

# VMのメリット
### OSレベルの詳細な設定が可能
パッチの適用など

冒頭の図で示した通りVMはホストOSとゲストOSが分離しています。そのためVM側のゲストOSを自由にカスタマイズすることができます。例えば、ディストリビューションの選択やパッチの適用、FireWallの設定などです。一方でコンテナはカーネルをホストと共有しているため、VMほどの自由さがありません。

正直、ここをメリット・デメリットどちらに感じるかは状況によると思います。インフラの管理を自分で自由にしたいならVMはメリットとなりますし、インフラよりもアプリケーション開発に集中したい場合はコンテナのようにOSレベルのカスタマイズ性は不要になるかと思います。
# まとめ
| 項目         | コンテナ                                        | VM                                                    |
|--------------|-------------------------------------------------|-------------------------------------------------------|
| **構造** | ホストOSのカーネルを共有                          | ホストOSの上にゲストOSが動作                          |
| **サイズ** | MB単位（軽量）                                  | GB単位（重い）                                        |
| **デリバリー** | Docker Hubなどで管理、`pull`で容易に起動可能       | アプリケーションモジュールのアップロードとコマンド起動が必要 |
| **起動/停止** | 容易（`docker run`, `docker stop`）                | アプリケーション起動/停止に手間がかかる場合がある        |
| **OSカスタマイズ** | ホストOSのカーネルを共有するため自由度が低い      | ゲストOSを自由にカスタマイズ可能（ディストリビューション選択、パッチ適用、FireWall設定など） |                                      |
