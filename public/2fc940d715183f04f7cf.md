---
title: 'SPF, DKIM, DMARCに対する自分の理解'
tags:
  - dns
  - DMARC
  - DKIM
  - spf
private: false
updated_at: '2024-01-19T08:16:39+09:00'
id: 2fc940d715183f04f7cf
organization_url_name: null
slide: false
ignorePublish: false
---
# SPF
- Sender Policy Framework
- 送信元のドメインの正当性をチェックする
- DNSにSPFレコードを登録し、メール受信側がSPFレコードをチェックする

# DKIM
- Domain Keys Identified Mail
- 電子証明書を用いて電子メール内容の改竄をチェックする
- 送信側が秘密鍵で電子証明書を生成、受信側が公開鍵で復号

![スクリーンショット 2024-01-18 21.54.34.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/159675/47198144-96df-cddd-fd0b-b28821684c4b.png)

# DMARC
- Domain-based Message Authentication, Reporting, and Conformance
- SPF, DKIMの認証に失敗したメールをどう扱うかは定義されていない。また、送信元ドメインは認証失敗を検知することができない。
- 送信元ドメインに認証失敗を知らせるための仕組みがDMARC
- DNSにDMARCレコードを登録することでDMARCポリシーを設定することができる


![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/159675/b76ecb0a-b4c4-5e8f-ed46-de803c85a627.png)

# `dig`コマンドでのDNSレコード調査方法
`[mail address domain]`は調査したいメールアドレスドメインです

## SPF
```bash
dig -t TXT [mail address domain] +short
```

## DKIM
```bash
dig -t TXT [DKIM selector]._domainkey.[mail address domain] +short
```
`[DKIM selector]`は受信したメールのヘッダに記載されている。
以下の`s=s2048g1`の部分。
```
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=hoge.com; s=s2048g1
```

## DMARC
```bash
dig -t TXT _dmarc.[mail address domain] +short
```
先頭に`_dmarc`をつけてコマンド実行する。

# 参考
https://www.nic.ad.jp/ja/basics/terms/dmarc.html

https://dev.classmethod.jp/articles/dmarc-record-step-by-step/
