---
title: テストコードにおけるIntegration TestとUnit Testの棲み分けに対する自分の考え方
tags:
  - 'テスト'
private: false
updated_at: ''
id: null
organization_url_name: null
slide: false
ignorePublish: false
---
- IT
    - happy pathを一本だけ
    - 管理下のものは本物を使う。管理外のオブジェクトはモックにする。
- UT
    - 網羅的なテストケースを作成する
- 共通
    - 結果に対してAssertionを行う。実装の詳細をAssertionしない。
    - 実行時間は限界まで切り詰める。遅いテストは開発体験を悪くする。

# はじめに
ソフトウェア開発におけるテストの重要性は、エンジニアであれば誰もが理解できると思います。自分もそれなりの年数ソフトウェアエンジニアをやってきて、テストにおける自分の考え方が少し整理されてきた感覚があります。今回は特にテストコードにおけるIntegration Test(IT)とUnit Test(UT)の棲み分けについて言語化します。

:::note
テストについては様々な考え方があり、私がこれから書くことに異を唱える方がいることは理解しています。10人いれば10通りの考え方がある世界なので、「こういう考え方もあるんだな」と一歩引いて読んでもらえると嬉しいです。

また、本記事に記したことは執筆時点での私の考えであり、今後学習していく中で考えや意見が変わりうることをご了承くださいませ。
::::

# ITとUTの棲み分け
## IT
テストコードでITを書く場合、自分は2つのポリシーを持っています。

1. モックは可能な限り使わない。依存オブジェクトやDBは本物を使う。（ただし外部APIなどのスコープ外のリソースはモック化する）
    - ITは本番環境と近い環境で実施したい
    - 依存オブジェクトはモック化せずにDIなどで本物を用意し、DBはコンテナやインメモリDBにテスト専用のテーブルを一時的に構築し、テスト終了時に破棄する。
    - もちろんコストはかかる。特にDBの準備・破棄は大変。テスト実行時間も延びがちなのできちんと計測してケアする必要がある。
2. 正常系のハッピーパスだけをテストケースに挙げる。異常系やエッジケースはITでは実装しない。
    - ハッピーパス=ビジネスシナリオが正常に終わる実行経路
    - 1でモックを利用しない方針をとっているので、私の書くITは実行時間が長くなりやすい。そのため、テストケースはあまり増やしたくない。
    - 細かいケースの網羅性は後述のUTで担保する。

## UT
UTにおける自分のポリシーは1つです。
1. 正常・異常どちらも網羅的にカバーするテストケースを実装する

